import{o as a,c as d,b as e,u as i,d as r,a as t,w as n}from"./app.96092cb2.js";const o=e("h1",{id:"什么是-emnapi",tabindex:"-1"},[r("什么是 emnapi "),e("a",{class:"header-anchor",href:"#什么是-emnapi","aria-hidden":"true"},"#")],-1),s=["src"],c=t('<p><code>emnapi</code> 适用于 Emscripten 的 <a href="https://nodejs.org/docs/v16.15.0/api/n-api.html" target="_blank" rel="noreferrer">Node-API</a> 子集实现。</p><h2 id="动机" tabindex="-1">动机 <a class="header-anchor" href="#动机" aria-hidden="true">#</a></h2><p>我构建这个库的目的是为了能够在尽可能不更改 C/C++ 代码的情况下将 Node-API 代码无缝编译成 Emscripten WebAssembly。</p><h2 id="为什么不用-embind" tabindex="-1">为什么不用 <code>embind</code> <a class="header-anchor" href="#为什么不用-embind" aria-hidden="true">#</a></h2><p>如果你不需要在浏览器和 Node.js 上运行相同的 Node-API 绑定代码，<code>embind</code> 非常好。使用 <code>embind</code> 编译成 wasm 也可以让你的代码同时在浏览器和 Node.js 上运行，但是当以 Node.js 为目标时，我们更倾向于编译到 Node.js 原生模块而不是 wasm 以获得原生性能。因此，在这种情况下，你可能需要为 Node.js 编写 Node-API 绑定，并为 Emscripten WebAssembly 编写 <code>embind</code> 绑定。你只是想让你的原生依赖项可以在 JavaScript 世界中使用，但你正在做重复的事情。</p><p>事实上，在调用绑定函数时，<code>emnapi</code> 应该比 <code>embind</code> 更慢且效率低下。但是当你非常希望共享 Node-API 绑定代码时，它仍然值得使用。</p><h2 id="浏览器兼容性" tabindex="-1">浏览器兼容性 <a class="header-anchor" href="#浏览器兼容性" aria-hidden="true">#</a></h2><p>先把 IE 忘掉吧。</p><p><code>emnapi</code> 发布的 JavaScript 代码都是 ES5，但需要 ES6 全局变量，例如 <code>WeakMap</code>，并且<a href="/emnapi-docs/zh/reference/list.html">一些 API</a> 需要 <code>BigInt</code>、<code>WeakRef</code> 和 <code>FinalizationRegistry</code>，这在 ES 标准中是非常新的，所以如果你用到了这些 API，你的代码将无法在稍微旧点的浏览器或旧版本 Node.js 上运行。你可以点击链接查看哪些浏览器支持 <a href="https://www.caniuse.com/?search=WeakRef" target="_blank" rel="noreferrer">WeakRef</a> 和 <a href="https://www.caniuse.com/?search=FinalizationRegistry" target="_blank" rel="noreferrer">FinalizationRegistry</a>。以 Chrome 为例，推荐目标浏览器版本高于 Chrome 84。</p><h2 id="可用于生产环境吗" tabindex="-1">可用于生产环境吗 <a class="header-anchor" href="#可用于生产环境吗" aria-hidden="true">#</a></h2><p>所有 Node.js 官方测试通过！功能可以得到保证。</p><p>经过简单的测试，常见的场景下它的性能几乎与 embind 处在同一水平，应该在可接受的范围内。</p><p>1.0 版本即将到来，目前并没有发布，因为用于内部实现的运行时 API 可能还需要频繁重构与变更，但这不影响用户使用 Node-API 本身的稳定 API。</p><p>你也可以试试<a href="https://github.com/toyobayashi/emnapi/pulls" target="_blank" rel="noreferrer">让 emnapi 变得更好</a>！</p>',14),b=JSON.parse('{"title":"什么是 emnapi","description":"","frontmatter":{"sidebarDepth":2},"headers":[{"level":2,"title":"动机","slug":"动机","link":"#动机","children":[]},{"level":2,"title":"为什么不用 embind","slug":"为什么不用-embind","link":"#为什么不用-embind","children":[]},{"level":2,"title":"浏览器兼容性","slug":"浏览器兼容性","link":"#浏览器兼容性","children":[]},{"level":2,"title":"可用于生产环境吗","slug":"可用于生产环境吗","link":"#可用于生产环境吗","children":[]}],"relativePath":"zh/guide/index.md","lastUpdated":1674492898000}'),h={name:"zh/guide/index.md"},f=Object.assign(h,{setup(l){return(p,m)=>(a(),d("div",null,[o,e("img",{src:i(n)("/emnapi.svg"),alt:"emnapi logo",width:"256"},null,8,s),c]))}});export{b as __pageData,f as default};
