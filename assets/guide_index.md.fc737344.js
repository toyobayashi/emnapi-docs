import{o as a,c as o,k as e,l as t,a as r,Q as i,f as s}from"./chunks/framework.21a77088.js";const n=e("h1",{id:"what-is-emnapi",tabindex:"-1"},[r("What is emnapi "),e("a",{class:"header-anchor",href:"#what-is-emnapi","aria-label":'Permalink to "What is emnapi"'},"​")],-1),l=["src"],d=i('<p><code>emnapi</code> is <s>a subset of</s> almost a full <a href="https://nodejs.org/docs/v16.15.0/api/n-api.html" target="_blank" rel="noreferrer"><strong>N</strong>ode-<strong>API</strong></a> (named NAPI previously) implementation for <strong>Em</strong>scripten, as well as <a href="https://github.com/WebAssembly/wasi-sdk" target="_blank" rel="noreferrer">wasi-sdk</a> and clang <code>wasm32-unknown-unknown</code> target from emnapi v0.29.0.</p><p>Emscripten is the first class support target.</p><h2 id="motivation" tabindex="-1">Motivation <a class="header-anchor" href="#motivation" aria-label="Permalink to &quot;Motivation&quot;">​</a></h2><p>This project aims to</p><ul><li>Help users port their or existing Node-API native addons to wasm with code change as less as possible.</li><li>Make runtime behavior matches native Node.js as much as possible.</li></ul><h2 id="why-not-embind" tabindex="-1">Why not <code>embind</code> <a class="header-anchor" href="#why-not-embind" aria-label="Permalink to &quot;Why not `embind`&quot;">​</a></h2><p><code>embind</code> is pretty good if you don&#39;t need to running same Node-API binding code on both browser and Node.js. Compiling to wasm by using <code>embind</code> can also make your code running on both browser and Node.js, but when targeting Node.js, we prefer compiling to Node.js native addon instead of wasm for native performance. So in this case you probably need to write Node-API binding for Node.js and <code>embind</code> binding for Emscripten WebAssembly. Look, you just want to make your native dependencies could be used in JavaScript world but you are doing duplicated things.</p><p>Another use case of emnapi is that you want to make your addon run on <a href="https://stackblitz.com/" target="_blank" rel="noreferrer">StackBlitz</a>&#39;s WebContainer.</p><h2 id="browser-compatibility" tabindex="-1">Browser Compatibility <a class="header-anchor" href="#browser-compatibility" aria-label="Permalink to &quot;Browser Compatibility&quot;">​</a></h2><p>Let&#39;s forget IE.</p><p><code>emnapi</code> JavaScript code is all ES5, but requires ES6 globals like <code>WeakMap</code>, and <a href="/emnapi-docs/reference/list.html">some of APIs</a> requires <code>BigInt</code>, <code>WeakRef</code> and <code>FinalizationRegistry</code> which is very new in ECMA Standard, so if you are using those APIs, your code will not work on old browsers or old version Node.js. You can click the link to see which browsers support <a href="https://www.caniuse.com/?search=WeakRef" target="_blank" rel="noreferrer">WeakRef</a> and <a href="https://www.caniuse.com/?search=FinalizationRegistry" target="_blank" rel="noreferrer">FinalizationRegistry</a>. Taking Chrome as an example, the recommended target browser version is higher than Chrome 84.</p><h2 id="is-it-ready-for-production" tabindex="-1">Is it ready for production? <a class="header-anchor" href="#is-it-ready-for-production" aria-label="Permalink to &quot;Is it ready for production?&quot;">​</a></h2><p>All Node.js official test passed! The functionality could be guaranteed. There are already well-known open source projects that are using or will use emnapi:</p><ul><li><a href="https://github.com/lovell/sharp" target="_blank" rel="noreferrer">sharp</a> on StackBlitz is using emnapi, see <a href="https://blog.stackblitz.com/posts/bringing-sharp-to-wasm-and-webcontainers/" target="_blank" rel="noreferrer">official blog</a></li><li><a href="https://github.com/napi-rs/napi-rs" target="_blank" rel="noreferrer">napi-rs</a> <a href="https://github.com/napi-rs/napi-rs/pull/1669" target="_blank" rel="noreferrer">has integrated emnapi</a> (v2.14.0+)</li><li><a href="https://github.com/mmomtchev/magickwand.js" target="_blank" rel="noreferrer">node-magickwand</a> as a Node-API showcase project of <a href="https://github.com/swig/swig" target="_blank" rel="noreferrer">SWIG</a>, has integrated emnapi</li></ul><p>After simple testing, found the call overhead of binding is slightly greater than that of embind in general scenarios, but it should be within an acceptable range.</p><p>You can also try to <a href="https://github.com/toyobayashi/emnapi/pulls" target="_blank" rel="noreferrer">make emnapi be better</a>!</p><h2 id="sponsors" tabindex="-1">Sponsors <a class="header-anchor" href="#sponsors" aria-label="Permalink to &quot;Sponsors&quot;">​</a></h2><p align="center"><a href="https://cdn.jsdelivr.net/gh/toyobayashi/toyobayashi/sponsorkit/sponsors.svg"><img src="https://cdn.jsdelivr.net/gh/toyobayashi/toyobayashi/sponsorkit/sponsors.svg"></a></p>',18),g=JSON.parse('{"title":"What is emnapi","description":"","frontmatter":{"sidebarDepth":2},"headers":[],"relativePath":"guide/index.md","filePath":"guide/index.md","lastUpdated":1706611505000}'),h={name:"guide/index.md"},u=Object.assign(h,{setup(c){return(p,m)=>(a(),o("div",null,[n,e("img",{src:t(s)("/emnapi.svg"),alt:"emnapi logo",width:"256"},null,8,l),d]))}});export{g as __pageData,u as default};
